{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n    host: process.env.DB_HOST || 'localhost',\r\n    port: parseInt(process.env.DB_PORT || '5434'),\r\n    user: process.env.DB_USER || 'biblioteca_admin',\r\n    password: process.env.DB_PASSWORD,\r\n    database: process.env.DB_NAME || 'biblioteca',\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;IAClB,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;IACtC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;AACrC;uCAEe"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/reports/socios/page.tsx"],"sourcesContent":["import Link from 'next/link';\r\nimport pool from '@/lib/db';\r\n\r\ninterface Socio {\r\n  id: number;\r\n  nombre: string;\r\n  tipo_membresia: string;\r\n  total_prestamos: string;\r\n  devoluciones_tardias: string;\r\n  tasa_morosidad_porcentaje: string;\r\n}\r\n\r\nasync function obtenerSocios(search?: string, page: number = 1) {\r\n  const client = await pool.connect();\r\n  const limit = 10;\r\n  const offset = (page - 1) * limit;\r\n\r\n  try {\r\n    const searchPattern = `%${search || ''}%`;\r\n\r\n    const dataQuery = `\r\n      SELECT * FROM vw_actividad_socios \r\n      WHERE nombre ILIKE $1 OR tipo_membresia ILIKE $1\r\n      ORDER BY tasa_morosidad_porcentaje DESC, total_prestamos DESC\r\n      LIMIT $2 OFFSET $3\r\n    `;\r\n\r\n    const countQuery = `\r\n      SELECT COUNT(*) as total FROM vw_actividad_socios \r\n      WHERE nombre ILIKE $1 OR tipo_membresia ILIKE $1\r\n    `;\r\n\r\n    const [dataResult, countResult] = await Promise.all([\r\n      client.query(dataQuery, [searchPattern, limit, offset]),\r\n      client.query(countQuery, [searchPattern])\r\n    ]);\r\n\r\n    return {\r\n      socios: dataResult.rows as Socio[],\r\n      total: parseInt(countResult.rows[0].total)\r\n    };\r\n  } finally {\r\n    client.release();\r\n  }\r\n}\r\n\r\nexport default async function PaginaSocios({\r\n  searchParams,\r\n}: {\r\n  searchParams: Promise<{ q?: string; page?: string }>;\r\n}) {\r\n  const params = await searchParams;\r\n  const page = parseInt(params.page || '1');\r\n  const { socios, total } = await obtenerSocios(params.q, page);\r\n\r\n  const totalPages = Math.ceil(total / 10);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"header\">\r\n        <Link href=\"/\" className=\"back-link\">← Volver al Dashboard</Link>\r\n        <h1>Actividad de Socios</h1>\r\n        <p>Análisis de comportamiento y riesgo de socios</p>\r\n      </div>\r\n\r\n      {/* Búsqueda */}\r\n      <form className=\"search-form\">\r\n        <input\r\n          type=\"text\"\r\n          name=\"q\"\r\n          placeholder=\"Buscar por nombre o tipo de membresía...\"\r\n          defaultValue={params.q || ''}\r\n        />\r\n        <button type=\"submit\" className=\"btn\">Buscar</button>\r\n      </form>\r\n\r\n      {/* Tabla */}\r\n      <div className=\"table-container\">\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th>Nombre</th>\r\n              <th>Tipo de Membresía</th>\r\n              <th>Total Préstamos</th>\r\n              <th>Devoluciones Tardías</th>\r\n              <th>Tasa de Morosidad</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {socios.map(socio => {\r\n              const tasa = parseFloat(socio.tasa_morosidad_porcentaje);\r\n              let riskClass = 'low';\r\n              if (tasa > 20) riskClass = 'medium';\r\n              if (tasa > 50) riskClass = 'high';\r\n\r\n              return (\r\n                <tr key={socio.id}>\r\n                  <td><strong>{socio.nombre}</strong></td>\r\n                  <td>\r\n                    <span className={`badge ${socio.tipo_membresia.toLowerCase()}`}>\r\n                      {socio.tipo_membresia}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"center\">{socio.total_prestamos}</td>\r\n                  <td className=\"center\">{socio.devoluciones_tardias}</td>\r\n                  <td className=\"center\">\r\n                    <span className={`risk ${riskClass}`}>\r\n                      {tasa.toFixed(1)}%\r\n                    </span>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n        {socios.length === 0 && <p className=\"no-data\">No se encontraron socios</p>}\r\n      </div>\r\n\r\n      {/* Paginación */}\r\n      {totalPages > 1 && (\r\n        <div className=\"pagination\">\r\n          <span>Página {page} de {totalPages}</span>\r\n          <div className=\"pagination-buttons\">\r\n            {page > 1 && (\r\n              <Link href={`/reports/socios?page=${page - 1}&q=${params.q || ''}`} className=\"btn-secondary\">\r\n                ← Anterior\r\n              </Link>\r\n            )}\r\n            {page < totalPages && (\r\n              <Link href={`/reports/socios?page=${page + 1}&q=${params.q || ''}`} className=\"btn-secondary\">\r\n                Siguiente →\r\n              </Link>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}