{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n    host: process.env.DB_HOST || 'localhost',\r\n    port: parseInt(process.env.DB_PORT || '5434'),\r\n    user: process.env.DB_USER || 'biblioteca_admin',\r\n    password: process.env.DB_PASSWORD,\r\n    database: process.env.DB_NAME || 'biblioteca',\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;IAClB,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;IACtC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;AACrC;uCAEe"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/reports/popular-books/page.tsx"],"sourcesContent":["import Link from 'next/link';\r\nimport pool from '@/lib/db';\r\n\r\ninterface LibroPopular {\r\n  id: number;\r\n  titulo: string;\r\n  autor: string;\r\n  total_prestamos: string;\r\n  ranking: string;\r\n}\r\n\r\nasync function getLibrosPopulares(search?: string, page: number = 1) {\r\n  const client = await pool.connect();\r\n  const limit = 10;\r\n  const offset = (page - 1) * limit;\r\n\r\n  try {\r\n    const searchPattern = `%${search || ''}%`;\r\n\r\n    const dataQuery = `\r\n      SELECT * FROM vw_libros_mas_prestados \r\n      WHERE titulo ILIKE $1 OR autor ILIKE $1\r\n      ORDER BY ranking ASC\r\n      LIMIT $2 OFFSET $3\r\n    `;\r\n\r\n    const countQuery = `\r\n      SELECT COUNT(*) as total FROM vw_libros_mas_prestados \r\n      WHERE titulo ILIKE $1 OR autor ILIKE $1\r\n    `;\r\n\r\n    const [dataResult, countResult] = await Promise.all([\r\n      client.query(dataQuery, [searchPattern, limit, offset]),\r\n      client.query(countQuery, [searchPattern])\r\n    ]);\r\n\r\n    return {\r\n      libros: dataResult.rows as LibroPopular[],\r\n      total: parseInt(countResult.rows[0].total)\r\n    };\r\n  } finally {\r\n    client.release();\r\n  }\r\n}\r\n\r\nexport default async function PopularBooksPage({\r\n  searchParams,\r\n}: {\r\n  searchParams: Promise<{ q?: string; page?: string }>;\r\n}) {\r\n  const params = await searchParams;\r\n  const page = parseInt(params.page || '1');\r\n  const { libros, total } = await getLibrosPopulares(params.q, page);\r\n\r\n  const totalPages = Math.ceil(total / 10);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"header\">\r\n        <Link href=\"/\" className=\"back-link\">← Volver al Dashboard</Link>\r\n        <h1>Libros Más Populares</h1>\r\n        <p>Ranking de libros más solicitados</p>\r\n      </div>\r\n\r\n      {/* Búsqueda */}\r\n      <form className=\"search-form\">\r\n        <input\r\n          type=\"text\"\r\n          name=\"q\"\r\n          placeholder=\"Buscar por título o autor...\"\r\n          defaultValue={params.q || ''}\r\n        />\r\n        <button type=\"submit\" className=\"btn\">Buscar</button>\r\n      </form>\r\n\r\n      {/* Tabla */}\r\n      <div className=\"table-container\">\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th>Ranking</th>\r\n              <th>Título</th>\r\n              <th>Autor</th>\r\n              <th>Total Préstamos</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {libros.map(libro => (\r\n              <tr key={libro.id}>\r\n                <td className=\"ranking\">#{libro.ranking}</td>\r\n                <td><strong>{libro.titulo}</strong></td>\r\n                <td>{libro.autor}</td>\r\n                <td className=\"center\">{libro.total_prestamos}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        {libros.length === 0 && <p className=\"no-data\">No se encontraron libros</p>}\r\n      </div>\r\n\r\n      {/* Paginación */}\r\n      {totalPages > 1 && (\r\n        <div className=\"pagination\">\r\n          <span>Página {page} de {totalPages}</span>\r\n          <div className=\"pagination-buttons\">\r\n            {page > 1 && (\r\n              <Link href={`/reports/popular-books?page=${page - 1}&q=${params.q || ''}`} className=\"btn-secondary\">\r\n                ← Anterior\r\n              </Link>\r\n            )}\r\n            {page < totalPages && (\r\n              <Link href={`/reports/popular-books?page=${page + 1}&q=${params.q || ''}`} className=\"btn-secondary\">\r\n                Siguiente →\r\n              </Link>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;;;;AAUA,eAAe,mBAAmB,MAAe,EAAE,OAAe,CAAC;IACjE,MAAM,SAAS,MAAM,2HAAI,CAAC,OAAO;IACjC,MAAM,QAAQ;IACd,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;IAE5B,IAAI;QACF,MAAM,gBAAgB,CAAC,CAAC,EAAE,UAAU,GAAG,CAAC,CAAC;QAEzC,MAAM,YAAY,CAAC;;;;;IAKnB,CAAC;QAED,MAAM,aAAa,CAAC;;;IAGpB,CAAC;QAED,MAAM,CAAC,YAAY,YAAY,GAAG,MAAM,QAAQ,GAAG,CAAC;YAClD,OAAO,KAAK,CAAC,WAAW;gBAAC;gBAAe;gBAAO;aAAO;YACtD,OAAO,KAAK,CAAC,YAAY;gBAAC;aAAc;SACzC;QAED,OAAO;YACL,QAAQ,WAAW,IAAI;YACvB,OAAO,SAAS,YAAY,IAAI,CAAC,EAAE,CAAC,KAAK;QAC3C;IACF,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEe,eAAe,iBAAiB,EAC7C,YAAY,EAGb;IACC,MAAM,SAAS,MAAM;IACrB,MAAM,OAAO,SAAS,OAAO,IAAI,IAAI;IACrC,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,mBAAmB,OAAO,CAAC,EAAE;IAE7D,MAAM,aAAa,KAAK,IAAI,CAAC,QAAQ;IAErC,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,0LAAI;wBAAC,MAAK;wBAAI,WAAU;kCAAY;;;;;;kCACrC,8OAAC;kCAAG;;;;;;kCACJ,8OAAC;kCAAE;;;;;;;;;;;;0BAIL,8OAAC;gBAAK,WAAU;;kCACd,8OAAC;wBACC,MAAK;wBACL,MAAK;wBACL,aAAY;wBACZ,cAAc,OAAO,CAAC,IAAI;;;;;;kCAE5B,8OAAC;wBAAO,MAAK;wBAAS,WAAU;kCAAM;;;;;;;;;;;;0BAIxC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;0CACC,cAAA,8OAAC;;sDACC,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;;;;;;;;;;;;0CAGR,8OAAC;0CACE,OAAO,GAAG,CAAC,CAAA,sBACV,8OAAC;;0DACC,8OAAC;gDAAG,WAAU;;oDAAU;oDAAE,MAAM,OAAO;;;;;;;0DACvC,8OAAC;0DAAG,cAAA,8OAAC;8DAAQ,MAAM,MAAM;;;;;;;;;;;0DACzB,8OAAC;0DAAI,MAAM,KAAK;;;;;;0DAChB,8OAAC;gDAAG,WAAU;0DAAU,MAAM,eAAe;;;;;;;uCAJtC,MAAM,EAAE;;;;;;;;;;;;;;;;oBAStB,OAAO,MAAM,KAAK,mBAAK,8OAAC;wBAAE,WAAU;kCAAU;;;;;;;;;;;;YAIhD,aAAa,mBACZ,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;4BAAK;4BAAQ;4BAAK;4BAAK;;;;;;;kCACxB,8OAAC;wBAAI,WAAU;;4BACZ,OAAO,mBACN,8OAAC,0LAAI;gCAAC,MAAM,CAAC,4BAA4B,EAAE,OAAO,EAAE,GAAG,EAAE,OAAO,CAAC,IAAI,IAAI;gCAAE,WAAU;0CAAgB;;;;;;4BAItG,OAAO,4BACN,8OAAC,0LAAI;gCAAC,MAAM,CAAC,4BAA4B,EAAE,OAAO,EAAE,GAAG,EAAE,OAAO,CAAC,IAAI,IAAI;gCAAE,WAAU;0CAAgB;;;;;;;;;;;;;;;;;;;;;;;;AAUnH"}}]
}