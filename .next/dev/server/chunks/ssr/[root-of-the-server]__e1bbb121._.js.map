{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n    host: process.env.DB_HOST || 'localhost',\r\n    port: parseInt(process.env.DB_PORT || '5434'),\r\n    user: process.env.DB_USER || 'biblioteca_admin',\r\n    password: process.env.DB_PASSWORD,\r\n    database: process.env.DB_NAME || 'biblioteca',\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,qJAAI,CAAC;IAClB,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;IACtC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;AACrC;uCAEe"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/back/prestamos.ts"],"sourcesContent":["import pool from '@/lib/db';\r\n\r\nexport interface PrestamoVencido {\r\n    prestamo_id: number;\r\n    socio: string;\r\n    email: string;\r\n    libro: string;\r\n    fecha_limite: Date;\r\n    dias_atraso: number;\r\n    multa_sugerida: string;\r\n}\r\n\r\nexport async function obtenerPrestamosVencidos(search?: string, page: number = 1) {\r\n    const client = await pool.connect();\r\n    const limit = 10;\r\n    const offset = (page - 1) * limit;\r\n\r\n    try {\r\n        const searchPattern = `%${search || ''}%`;\r\n\r\n        const dataQuery = `\r\n      SELECT * FROM vw_prestamos_vencidos \r\n      WHERE socio ILIKE $1 OR libro ILIKE $1\r\n      ORDER BY dias_atraso DESC\r\n      LIMIT $2 OFFSET $3\r\n    `;\r\n\r\n        const countQuery = `\r\n      SELECT COUNT(*) as total, SUM(multa_sugerida) as deuda_total \r\n      FROM vw_prestamos_vencidos \r\n      WHERE socio ILIKE $1 OR libro ILIKE $1\r\n    `;\r\n\r\n        const [dataResult, countResult] = await Promise.all([\r\n            client.query(dataQuery, [searchPattern, limit, offset]),\r\n            client.query(countQuery, [searchPattern])\r\n        ]);\r\n\r\n        return {\r\n            prestamos: dataResult.rows as PrestamoVencido[],\r\n            total: parseInt(countResult.rows[0].total),\r\n            deudaTotal: parseFloat(countResult.rows[0].deuda_total || '0')\r\n        };\r\n    } finally {\r\n        client.release();\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAYO,eAAe,yBAAyB,MAAe,EAAE,OAAe,CAAC;IAC5E,MAAM,SAAS,MAAM,2HAAI,CAAC,OAAO;IACjC,MAAM,QAAQ;IACd,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;IAE5B,IAAI;QACA,MAAM,gBAAgB,CAAC,CAAC,EAAE,UAAU,GAAG,CAAC,CAAC;QAEzC,MAAM,YAAY,CAAC;;;;;IAKvB,CAAC;QAEG,MAAM,aAAa,CAAC;;;;IAIxB,CAAC;QAEG,MAAM,CAAC,YAAY,YAAY,GAAG,MAAM,QAAQ,GAAG,CAAC;YAChD,OAAO,KAAK,CAAC,WAAW;gBAAC;gBAAe;gBAAO;aAAO;YACtD,OAAO,KAAK,CAAC,YAAY;gBAAC;aAAc;SAC3C;QAED,OAAO;YACH,WAAW,WAAW,IAAI;YAC1B,OAAO,SAAS,YAAY,IAAI,CAAC,EAAE,CAAC,KAAK;YACzC,YAAY,WAAW,YAAY,IAAI,CAAC,EAAE,CAAC,WAAW,IAAI;QAC9D;IACJ,SAAU;QACN,OAAO,OAAO;IAClB;AACJ"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/reports/prestamos-vencidos/page.tsx"],"sourcesContent":["import Link from 'next/link';\r\nimport { obtenerPrestamosVencidos } from '@/lib/back/prestamos';\r\n\r\nexport default async function PaginaPrestamosVencidos({\r\n  searchParams,\r\n}: {\r\n  searchParams: Promise<{ q?: string; page?: string }>;\r\n}) {\r\n  const params = await searchParams;\r\n  const page = parseInt(params.page || '1');\r\n  const { prestamos, total, deudaTotal } = await obtenerPrestamosVencidos(params.q, page);\r\n\r\n  const totalPages = Math.ceil(total / 10);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"header\">\r\n        <Link href=\"/\" className=\"back-link\">← Volver al Dashboard</Link>\r\n        <h1>Préstamos Vencidos</h1>\r\n        <p>Monitoreo de morosidad y cálculo de multas</p>\r\n      </div>\r\n\r\n      {/* KPI */}\r\n      <div className=\"kpi-single\">\r\n        <h3>Deuda Total Potencial</h3>\r\n        <p className=\"kpi-value\">${deudaTotal.toFixed(2)}</p>\r\n        <p className=\"kpi-subtitle\">{total} préstamos vencidos</p>\r\n      </div>\r\n\r\n      {/* Búsqueda */}\r\n      <form className=\"search-form\">\r\n        <input\r\n          type=\"text\"\r\n          name=\"q\"\r\n          placeholder=\"Buscar por socio o libro...\"\r\n          defaultValue={params.q || ''}\r\n        />\r\n        <button type=\"submit\" className=\"btn\">Buscar</button>\r\n      </form>\r\n\r\n      {/* Tabla */}\r\n      <div className=\"table-container\">\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th>Socio</th>\r\n              <th>Libro</th>\r\n              <th>Fecha Límite</th>\r\n              <th>Días de Atraso</th>\r\n              <th>Multa Sugerida</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {prestamos.map(p => (\r\n              <tr key={p.prestamo_id}>\r\n                <td>\r\n                  <div><strong>{p.socio}</strong></div>\r\n                  <div className=\"email\">{p.email}</div>\r\n                </td>\r\n                <td>{p.libro}</td>\r\n                <td>{new Date(p.fecha_limite).toLocaleDateString('es-MX')}</td>\r\n                <td>\r\n                  <span className={`badge ${p.dias_atraso > 10 ? 'red' : 'yellow'}`}>\r\n                    {p.dias_atraso} días\r\n                  </span>\r\n                </td>\r\n                <td className=\"money\">${parseFloat(p.multa_sugerida).toFixed(2)}</td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n        {prestamos.length === 0 && <p className=\"no-data\">No hay préstamos vencidos</p>}\r\n      </div>\r\n\r\n      {/* Paginación */}\r\n      {totalPages > 1 && (\r\n        <div className=\"pagination\">\r\n          <span>Página {page} de {totalPages}</span>\r\n          <div className=\"pagination-buttons\">\r\n            {page > 1 && (\r\n              <Link href={`/reports/prestamos-vencidos?page=${page - 1}&q=${params.q || ''}`} className=\"btn-secondary\">\r\n                ← Anterior\r\n              </Link>\r\n            )}\r\n            {page < totalPages && (\r\n              <Link href={`/reports/prestamos-vencidos?page=${page + 1}&q=${params.q || ''}`} className=\"btn-secondary\">\r\n                Siguiente →\r\n              </Link>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;;;;AAEe,eAAe,wBAAwB,EACpD,YAAY,EAGb;IACC,MAAM,SAAS,MAAM;IACrB,MAAM,OAAO,SAAS,OAAO,IAAI,IAAI;IACrC,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,MAAM,IAAA,2JAAwB,EAAC,OAAO,CAAC,EAAE;IAElF,MAAM,aAAa,KAAK,IAAI,CAAC,QAAQ;IAErC,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,0LAAI;wBAAC,MAAK;wBAAI,WAAU;kCAAY;;;;;;kCACrC,8OAAC;kCAAG;;;;;;kCACJ,8OAAC;kCAAE;;;;;;;;;;;;0BAIL,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;kCAAG;;;;;;kCACJ,8OAAC;wBAAE,WAAU;;4BAAY;4BAAE,WAAW,OAAO,CAAC;;;;;;;kCAC9C,8OAAC;wBAAE,WAAU;;4BAAgB;4BAAM;;;;;;;;;;;;;0BAIrC,8OAAC;gBAAK,WAAU;;kCACd,8OAAC;wBACC,MAAK;wBACL,MAAK;wBACL,aAAY;wBACZ,cAAc,OAAO,CAAC,IAAI;;;;;;kCAE5B,8OAAC;wBAAO,MAAK;wBAAS,WAAU;kCAAM;;;;;;;;;;;;0BAIxC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;0CACC,cAAA,8OAAC;;sDACC,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;;;;;;;;;;;;0CAGR,8OAAC;0CACE,UAAU,GAAG,CAAC,CAAA,kBACb,8OAAC;;0DACC,8OAAC;;kEACC,8OAAC;kEAAI,cAAA,8OAAC;sEAAQ,EAAE,KAAK;;;;;;;;;;;kEACrB,8OAAC;wDAAI,WAAU;kEAAS,EAAE,KAAK;;;;;;;;;;;;0DAEjC,8OAAC;0DAAI,EAAE,KAAK;;;;;;0DACZ,8OAAC;0DAAI,IAAI,KAAK,EAAE,YAAY,EAAE,kBAAkB,CAAC;;;;;;0DACjD,8OAAC;0DACC,cAAA,8OAAC;oDAAK,WAAW,CAAC,MAAM,EAAE,EAAE,WAAW,GAAG,KAAK,QAAQ,UAAU;;wDAC9D,EAAE,WAAW;wDAAC;;;;;;;;;;;;0DAGnB,8OAAC;gDAAG,WAAU;;oDAAQ;oDAAE,WAAW,EAAE,cAAc,EAAE,OAAO,CAAC;;;;;;;;uCAZtD,EAAE,WAAW;;;;;;;;;;;;;;;;oBAiB3B,UAAU,MAAM,KAAK,mBAAK,8OAAC;wBAAE,WAAU;kCAAU;;;;;;;;;;;;YAInD,aAAa,mBACZ,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;4BAAK;4BAAQ;4BAAK;4BAAK;;;;;;;kCACxB,8OAAC;wBAAI,WAAU;;4BACZ,OAAO,mBACN,8OAAC,0LAAI;gCAAC,MAAM,CAAC,iCAAiC,EAAE,OAAO,EAAE,GAAG,EAAE,OAAO,CAAC,IAAI,IAAI;gCAAE,WAAU;0CAAgB;;;;;;4BAI3G,OAAO,4BACN,8OAAC,0LAAI;gCAAC,MAAM,CAAC,iCAAiC,EAAE,OAAO,EAAE,GAAG,EAAE,OAAO,CAAC,IAAI,IAAI;gCAAE,WAAU;0CAAgB;;;;;;;;;;;;;;;;;;;;;;;;AAUxH"}}]
}